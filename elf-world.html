<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Emoji Zelda</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    body {
      font-family: sans-serif;
    }

    .view {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    .world {
      position: absolute;
      display: grid;
      transition: transform 0.1s ease-out;
    }

    .tile {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }

    .player {
      position: absolute;
      z-index: 10;
      pointer-events: none;
    }
  </style>
</head>
<body>

<div class="view">
  <div id="world" class="world"></div>
  <div id="player" class="player">üßù‚Äç‚ôÇÔ∏è</div>
</div>

<script>
  const COLS = 30
  const ROWS = 20
  const VIEW_WIDTH = 10
  const VIEW_HEIGHT = 8

  const worldEl = document.getElementById('world')
  const playerEl = document.getElementById('player')

  let tileWidth, tileHeight

  function resizeTiles() {
    tileWidth = window.innerWidth / VIEW_WIDTH
    tileHeight = window.innerHeight / VIEW_HEIGHT

    worldEl.style.gridTemplateColumns = `repeat(${COLS}, ${tileWidth}px)`
    worldEl.style.gridTemplateRows = `repeat(${ROWS}, ${tileHeight}px)`
    worldEl.style.width = `${COLS * tileWidth}px`
    worldEl.style.height = `${ROWS * tileHeight}px`

    playerEl.style.width = `${tileWidth}px`
    playerEl.style.height = `${tileHeight}px`

    updatePlayer()
    updateCamera()
  }

  const tiles = []
  for (let y = 0; y < ROWS; y++) {
    for (let x = 0; x < COLS; x++) {
      const tile = document.createElement('div')
      tile.className = 'tile'
      tile.dataset.x = x
      tile.dataset.y = y
      tile.textContent = Math.random() < 0.1 ? 'üå≤' : ''
      worldEl.appendChild(tile)
      tiles.push(tile)
    }
  }

  let px = 15
  let py = 10
  let cameraX = px
  let cameraY = py

  function clamp(val, min, max) {
    return Math.max(min, Math.min(max, val))
  }

  function updatePlayer() {
    playerEl.style.left = `${px * tileWidth}px`
    playerEl.style.top = `${py * tileHeight}px`
  }

  function updateCamera() {
    const marginX = Math.floor(VIEW_WIDTH / 2)
    const marginY = Math.floor(VIEW_HEIGHT / 2)

    if (px < cameraX - marginX + 1) cameraX = clamp(px + marginX - 1, marginX, COLS - marginX - 1)
    if (px > cameraX + marginX - 1) cameraX = clamp(px - marginX + 1, marginX, COLS - marginX - 1)
    if (py < cameraY - marginY + 1) cameraY = clamp(py + marginY - 1, marginY, ROWS - marginY - 1)
    if (py > cameraY + marginY - 1) cameraY = clamp(py - marginY + 1, marginY, ROWS - marginY - 1)

    const offsetX = clamp(cameraX - marginX, 0, COLS - VIEW_WIDTH) * tileWidth
    const offsetY = clamp(cameraY - marginY, 0, ROWS - VIEW_HEIGHT) * tileHeight

    worldEl.style.transform = `translate(${-offsetX}px, ${-offsetY}px)`
    playerEl.style.transform = `translate(${-offsetX}px, ${-offsetY}px)`
  }

  function move(dx, dy) {
    px = clamp(px + dx, 0, COLS - 1)
    py = clamp(py + dy, 0, ROWS - 1)
    updatePlayer()
    updateCamera()
  }

  window.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') move(-1, 0)
    else if (e.key === 'ArrowRight') move(1, 0)
    else if (e.key === 'ArrowUp') move(0, -1)
    else if (e.key === 'ArrowDown') move(0, 1)
  })

  window.addEventListener('resize', resizeTiles)

  resizeTiles()
</script>

</body>
</html>
